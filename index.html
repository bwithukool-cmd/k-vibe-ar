<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>K-VIBE Stable AR Menu</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
      /* 버튼이 잘 눌리도록 커서(마우스) 스타일 지정 */
      .clickable { cursor: pointer; }
    </style>
  </head>
  
  <body style="margin: 0px; overflow: hidden;">
    <a-scene embedded 
             arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;" 
             cursor="fuse: false; rayOrigin: mouse"
             raycaster="objects: .clickable">
      
      <a-assets>
        <video id="k-vibe-video" src="test.mp4" crossorigin="anonymous" playsinline webkit-playsinline></video>
        <img id="coupon-img" src="sample.jpg">
      </a-assets>

      <a-marker preset="hiro" id="main-marker" emitevents="true">
        
        <a-entity position="0 0.1 -1.8" rotation="-90 0 0">
          <a-text id="welcome-text" value="Welcome to K-VIBE" align="center" color="#FFF" width="6"></a-text>
        </a-entity>

        <a-video id="video-display" src="#k-vibe-video" position="0 0.5 -0.5" width="2" height="1.1" rotation="-90 0 0" visible="false"></a-video>
        <a-image id="coupon-display" src="#coupon-img" position="0 0.5 -0.5" width="1.5" height="1.5" rotation="-90 0 0" visible="false"></a-image>

        <a-entity id="btn-video" position="-1.2 0.2 0.8" rotation="-90 0 0" class="clickable" onclick="showVideo()">
          <a-plane color="#FF5722" width="1" height="0.5"></a-plane>
          <a-text value="Video" align="center" color="#FFF" width="4" position="0 0 0.1"></a-text>
        </a-entity>

        <a-entity id="btn-survey" position="0 0.2 0.8" rotation="-90 0 0" class="clickable" onclick="goToSurvey()">
          <a-plane id="survey-plane" color="#4CAF50" width="1" height="0.5"></a-plane>
          <a-text value="Survey" align="center" color="#FFF" width="4" position="0 0 0.1"></a-text>
        </a-entity>

        <a-entity id="btn-coupon" position="1.2 0.2 0.8" rotation="-90 0 0" class="clickable" onclick="showCoupon()">
          <a-plane color="#2196F3" width="1" height="0.5"></a-plane>
          <a-text value="Coupon" align="center" color="#FFF" width="4" position="0 0 0.1"></a-text>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const userType = urlParams.get('type');
      const welcomeText = document.querySelector('#welcome-text');

      // 무슬림 모드 설정 변경 적용
      if (userType === 'muslim') {
        welcomeText.setAttribute('value', 'Assalamu Alaikum! K-VIBE');
        document.querySelector('#survey-plane').setAttribute('color', '#006400');
      }

      const video = document.querySelector('#k-vibe-video');
      const videoDisplay = document.querySelector('#video-display');
      const couponDisplay = document.querySelector('#coupon-display');

      function showVideo() {
        couponDisplay.setAttribute('visible', 'false');
        videoDisplay.setAttribute('visible', 'true');
        video.play();
      }

      function showCoupon() {
        video.pause();
        videoDisplay.setAttribute('visible', 'false');
        couponDisplay.setAttribute('visible', 'true');
      }
      
      function goToSurvey() {
        window.location.href = 'https://bit.ly/4qcWOQK';
      }
    </script>
  </body>
</html>